---
import Section from '../Section.astro'
import SkillBadge from '../ui/SkillBadge.astro'
import { loadCV } from '@/utils/cvLoader'

const CV = await loadCV();
const { skills = [] } = CV;


const skillsByCategory = skills.reduce((acc: Record<string, any[]>, skill: any) => {
  const category = skill.category || 'Other'
  if (!acc[category]) {
    acc[category] = []
  }
  acc[category].push(skill)
  return acc
}, {})


const categoryOrder = ['Programming', 'GPU', 'ML', 'Tools']
const sortedCategories = categoryOrder.filter(cat => skillsByCategory[cat])
---

<Section className={Astro.props.className} title='Skills'>
  <div class='space-y-5 print:space-y-3'>
    {sortedCategories.map(category => (
      <div>
        <h4 class='text-sm font-medium text-skin-base mb-3 print:mb-2'>
          {category}
        </h4>
        <div class='flex flex-wrap gap-2 print:gap-1'>
          {skillsByCategory[category].map(({ name, icon, level }: any) => (
            <SkillBadge name={name} icon={icon} level={level} />
          ))}
        </div>
      </div>
    ))}
  </div>
</Section>
